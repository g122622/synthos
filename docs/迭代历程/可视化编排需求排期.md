# å¯è§†åŒ–å·¥ä½œæµç¼–æ’ â€”â€” éœ€æ±‚åˆ†è§£ä¸æ’æœŸæ–‡æ¡£

> æ–‡æ¡£ç¼–åˆ¶æ—¥æœŸï¼š2026-02-06  
> ç‰ˆæœ¬ï¼šv1.0  
> çŠ¶æ€ï¼šå¾…è¯„å®¡

---

## ä¸€ã€éœ€æ±‚å…¨æ™¯å›¾

```
å¯è§†åŒ–å·¥ä½œæµç¼–æ’
â”œâ”€â”€ P0 - å·¥ä½œæµå¼•æ“å†…æ ¸ï¼ˆDAG è¿è¡Œæ—¶ï¼‰
â”‚   â”œâ”€â”€ T1.1 æµç¨‹å®šä¹‰å¥‘çº¦ï¼ˆç±»å‹ & Schemaï¼‰
â”‚   â”œâ”€â”€ T1.2 DAG æ‹“æ‰‘è§£æä¸æ ¡éªŒ
â”‚   â”œâ”€â”€ T1.3 æ‰§è¡Œå¼•æ“æ ¸å¿ƒï¼ˆä¸²è¡Œ/å¹¶è¡Œ/åˆ†æ”¯/æ±‡èšï¼‰
â”‚   â”œâ”€â”€ T1.4 ExecutionContextï¼ˆå…¨å±€ä¸Šä¸‹æ–‡ & èŠ‚ç‚¹è¾“å‡ºä¼ é€’ï¼‰
â”‚   â”œâ”€â”€ T1.5 æ‰§è¡ŒçŠ¶æ€æŒä¹…åŒ–ä¸æ–­ç‚¹ç»­è·‘
â”‚   â”œâ”€â”€ T1.6 é‡è¯•/è¶…æ—¶/è·³è¿‡/å¤±è´¥ç­–ç•¥
â”‚   â””â”€â”€ T1.7 å•å…ƒæµ‹è¯•è¦†ç›–
â”‚
â”œâ”€â”€ P1 - Orchestrator æ”¹é€  & tRPC é€šä¿¡å±‚
â”‚   â”œâ”€â”€ T2.1 Orchestrator tRPC Server æ­å»º
â”‚   â”œâ”€â”€ T2.2 RPC æ¥å£å®šä¹‰ï¼ˆcommon/rpc/orchestratorï¼‰
â”‚   â”œâ”€â”€ T2.3 webui-backend ä½œä¸º tRPC å®¢æˆ·ç«¯è½¬å‘
â”‚   â”œâ”€â”€ T2.4 ç°æœ‰ç¡¬ç¼–ç  Pipeline åˆ é™¤ & é»˜è®¤æµç¨‹å®šä¹‰è¿ç§»
â”‚   â””â”€â”€ T2.5 reportScheduler çº³å…¥å®šæ—¶ä»»åŠ¡ä½“ç³»
â”‚
â”œâ”€â”€ P2 - æµç¨‹å®šä¹‰å­˜å‚¨ & é…ç½®é›†æˆ
â”‚   â”œâ”€â”€ T3.1 GlobalConfig ä¸­æ–°å¢ workflows å­—æ®µ & Schema
â”‚   â”œâ”€â”€ T3.2 é»˜è®¤ WorkflowDefinitionï¼ˆå¯¹æ ‡ç°æœ‰ 6 æ­¥ Pipelineï¼‰
â”‚   â”œâ”€â”€ T3.3 é…ç½®ä¿å­˜ Diff ç¡®è®¤æœºåˆ¶ï¼ˆå¤ç”¨ç°æœ‰ config-panel æ¨¡å¼ï¼‰
â”‚   â””â”€â”€ T3.4 è¿è¡Œæ—¶æ·±æ‹·è´å¿«ç…§
â”‚
â”œâ”€â”€ P3 - å‰ç«¯å¯è§†åŒ–ç¼–æ’é¡µé¢
â”‚   â”œâ”€â”€ T4.1 React Flow + Zustand åŸºç¡€é›†æˆ
â”‚   â”œâ”€â”€ T4.2 è‡ªå®šä¹‰èŠ‚ç‚¹ç»„ä»¶ï¼ˆtask/condition/start/end/script/http/parallelï¼‰
â”‚   â”œâ”€â”€ T4.3 èŠ‚ç‚¹å±æ€§é¢æ¿ï¼ˆä¾§è¾¹æ ç¼–è¾‘èŠ‚ç‚¹å‚æ•°ï¼‰
â”‚   â”œâ”€â”€ T4.4 æ‹–æ‹½æ·»åŠ èŠ‚ç‚¹ & è¿çº¿äº¤äº’
â”‚   â”œâ”€â”€ T4.5 æµç¨‹ä¿å­˜/åŠ è½½/Diff é¢„è§ˆ
â”‚   â”œâ”€â”€ T4.6 æ‰§è¡ŒçŠ¶æ€å®æ—¶å¯è§†åŒ–ï¼ˆèŠ‚ç‚¹é¢œè‰²/è¿›åº¦/åŠ¨ç”»ï¼‰
â”‚   â””â”€â”€ T4.7 æµç¨‹æ‰§è¡Œå†å²åˆ—è¡¨
â”‚
â”œâ”€â”€ P4 - æ—¥å¿—ç³»ç»Ÿæ”¹é€ 
â”‚   â”œâ”€â”€ T5.1 Logger å¢åŠ æ‰§è¡Œ IDï¼ˆexecutionIdï¼‰æ ‡ç­¾
â”‚   â”œâ”€â”€ T5.2 åç«¯ Logs API æ”¯æŒæŒ‰ executionId/taskName è¿‡æ»¤
â”‚   â”œâ”€â”€ T5.3 logs.tsx æå‡ä¸ºå…¬å…±ç»„ä»¶å¹¶æ”¯æŒ executionId è¿‡æ»¤
â”‚   â””â”€â”€ T5.4 å·¥ä½œæµé¡µé¢å†…åµŒæ—¥å¿—é¢æ¿
â”‚
â””â”€â”€ P5 - æ–‡æ¡£ & å–„å
    â”œâ”€â”€ T6.1 æ›´æ–° æ ¹ç›®å½• README.md
    â”œâ”€â”€ T6.2 æ›´æ–° orchestrator/README.md
    â”œâ”€â”€ T6.3 æ›´æ–° docs/æ¥å£æ–‡æ¡£/APIæ–‡æ¡£.md
    â”œâ”€â”€ T6.4 æ–°å¢ docs/å·¥ä½œæµç¼–æ’ä½¿ç”¨æŒ‡å—.md
    â””â”€â”€ T6.5 æ–°å¢ docs/å·¥ä½œæµç¼–æ’æŠ€æœ¯æŠ¥å‘Š.md
```

---

## äºŒã€é˜¶æ®µè¯¦ç»†æ‹†è§£

### Phase 0ï¼ˆP0ï¼‰ï¼šå·¥ä½œæµå¼•æ“å†…æ ¸

> **ç›®æ ‡**ï¼šå®ç°ä¸€ä¸ªä¸ä¸šåŠ¡é€»è¾‘å®Œå…¨è§£è€¦çš„ DAG æ‰§è¡Œå¼•æ“ï¼Œæ”¾ç½®åœ¨ `applications/orchestrator/src/core` ä¸‹ï¼Œæ‰€æœ‰å­é¡¹ç›®å‡å¯å¼•ç”¨ã€‚

#### T1.1 æµç¨‹å®šä¹‰å¥‘çº¦ï¼ˆç±»å‹ & Schemaï¼‰

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `common/contracts/workflow/index.ts` |
| **å·¥ä½œé‡** | 0.5d |
| **å‰ç½®ä¾èµ–** | æ—  |
| **æ ¸å¿ƒå†…å®¹** | |

- å®šä¹‰ `WorkflowDefinition`ã€`WorkflowNode`ã€`WorkflowEdge` æ¥å£
- èŠ‚ç‚¹ç±»å‹æšä¸¾ `WorkflowNodeType`ï¼š`start` / `end` / `task` / `condition` / `parallel` / `script` / `http`
- èŠ‚ç‚¹æ•°æ® `WorkflowNodeData`ï¼ˆå« `label`ã€`taskType`ã€`params`ã€`retryCount`ã€`timeoutMs`ã€`skipOnFailure`ã€`conditionExpression`ã€`scriptCode`ã€`httpConfig`ï¼‰
- è¾¹æ•°æ® `WorkflowEdge`ï¼ˆå« `sourceHandle` ç”¨äºæ¡ä»¶åˆ†æ”¯ã€`label`ï¼‰
- æ‰§è¡ŒçŠ¶æ€æšä¸¾ `NodeExecutionStatus`ï¼š`pending` / `running` / `success` / `failed` / `skipped` / `cancelled`
- æ‰§è¡Œå®ä¾‹ `WorkflowExecution`ï¼ˆå« `executionId`ã€`workflowId`ã€`status`ã€`nodeStates`ã€`startedAt`ã€`completedAt`ã€`snapshot`ï¼‰
- æ¡ä»¶è¡¨è¾¾å¼ç±»å‹ `ConditionExpression`ï¼ˆé¢„å®šä¹‰å‡ ç§å†…ç½®æ¡ä»¶ï¼š`previousNodeSuccess`ã€`previousNodeFailed`ã€`keyValueMatch`ï¼‰
- Zod Schema æ ¡éªŒï¼ˆä¾› ConfigManagerService å’Œ RPC ä½¿ç”¨ï¼‰
- viewport å­—æ®µï¼ˆ`{ x, y, zoom }`ï¼‰ä¾› React Flow ç”»å¸ƒçŠ¶æ€ä¿å­˜/æ¢å¤

#### T1.2 DAG æ‹“æ‰‘è§£æä¸æ ¡éªŒ

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `applications/orchestrator/src/core/DagParser.ts` |
| **å·¥ä½œé‡** | 1d |
| **å‰ç½®ä¾èµ–** | T1.1 |
| **æ ¸å¿ƒå†…å®¹** | |

- åŸºäº `nodes[]` + `edges[]` æ„å»ºé‚»æ¥è¡¨
- å…¥åº¦åˆ†æ â†’ **Kahn ç®—æ³•**æ‹“æ‰‘æ’åº
- **ç¯æ£€æµ‹**ï¼šè‹¥æ‹“æ‰‘æ’åºåå‰©ä½™èŠ‚ç‚¹ > 0 åˆ™æœ‰ç¯ï¼ŒæŠ›å‡ºæ˜ç¡®é”™è¯¯
- æ ¡éªŒ start/end èŠ‚ç‚¹æ•°é‡ï¼ˆæ°å¥½å„ä¸€ä¸ªï¼‰
- æ ¡éªŒè¿é€šæ€§ï¼šæ‰€æœ‰èŠ‚ç‚¹ä» start å¯è¾¾
- è¯†åˆ«å¹¶è¡Œåˆ†æ”¯ï¼ˆä¸€ä¸ªèŠ‚ç‚¹æœ‰å¤šæ¡å‡ºè¾¹ä¸”ç›®æ ‡èŠ‚ç‚¹æ— å…±åŒå…¥è¾¹åˆ™ä¸ºå¹¶è¡Œåˆ†æ”¯ï¼‰
- è¯†åˆ«æ±‡èšç‚¹ï¼ˆå¤šæ¡å…¥è¾¹æ±‡èšçš„èŠ‚ç‚¹ï¼‰
- è¾“å‡º `ExecutionPlan`ï¼šä¸€ä¸ªæœ‰åºçš„"æ‰§è¡Œå±‚"åˆ—è¡¨ï¼Œæ¯å±‚å†…çš„èŠ‚ç‚¹å¯ä»¥å¹¶è¡Œæ‰§è¡Œ

#### T1.3 æ‰§è¡Œå¼•æ“æ ¸å¿ƒ

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `applications/orchestrator/src/core/WorkflowExecutor.ts` |
| **å·¥ä½œé‡** | 3d |
| **å‰ç½®ä¾èµ–** | T1.1, T1.2 |
| **æ ¸å¿ƒå†…å®¹** | |

- `WorkflowExecutor` ç±»ï¼šæ¥å— `WorkflowDefinition` + `NodeExecutorAdapter`ï¼ˆç­–ç•¥æ¥å£ï¼‰
- **`NodeExecutorAdapter` æ¥å£**ï¼š
  ```ts
  interface NodeExecutorAdapter {
    executeTaskNode(nodeId: string, taskType: string, params: Record<string, any>, context: ExecutionContext): Promise<NodeExecutionResult>;
    executeScriptNode(nodeId: string, scriptCode: string, context: ExecutionContext): Promise<NodeExecutionResult>;
    executeHttpNode(nodeId: string, httpConfig: HttpNodeConfig, context: ExecutionContext): Promise<NodeExecutionResult>;
  }
  ```
  è¿™æ˜¯å¼•æ“ä¸ä¸šåŠ¡è§£è€¦çš„å…³é”®â€”â€”å¼•æ“ä¸çŸ¥é“"ä»»åŠ¡æ€ä¹ˆåš"ï¼ŒåªçŸ¥é“"å›¾æ€ä¹ˆèµ°"
- æ‰§è¡Œæµç¨‹ï¼š
  1. æ·±æ‹·è´ `WorkflowDefinition` ä½œä¸ºå¿«ç…§
  2. è°ƒç”¨ `DagParser` ç”Ÿæˆ `ExecutionPlan`
  3. ä» start èŠ‚ç‚¹å¼€å§‹ï¼Œé€å±‚æ¨è¿›
  4. æ¯å±‚å†…çš„èŠ‚ç‚¹ `Promise.allSettled` å¹¶è¡Œæ‰§è¡Œ
  5. æ¡ä»¶èŠ‚ç‚¹ï¼šæ±‚å€¼æ¡ä»¶è¡¨è¾¾å¼ â†’ å†³å®šèµ°å“ªæ¡å‡ºè¾¹
  6. æ±‡èšèŠ‚ç‚¹ï¼šç­‰å¾…æ‰€æœ‰å…¥è¾¹çš„æºèŠ‚ç‚¹å®Œæˆ
  7. æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œå®Œæ¯•åæ›´æ–° `nodeStates` å¹¶æŒä¹…åŒ–
- äº‹ä»¶å‘å°„å™¨ï¼ˆ`EventEmitter`ï¼‰ï¼š`nodeStarted` / `nodeCompleted` / `nodeFailed` / `executionCompleted` / `executionFailed`ï¼Œä¾›å¤–éƒ¨ç›‘å¬

æ³¨æ„ï¼šç°æœ‰ Agenda é…ç½® maxConcurrency: 1ã€‚å½“ DAG ä¸­å‡ºç°å¹¶è¡ŒèŠ‚ç‚¹ï¼ˆå¦‚ GenerateEmbedding å’Œ InterestScore åŒæ—¶æ‰§è¡Œï¼‰ï¼Œå¸Œæœ›ï¼šè°ƒé«˜ Agenda maxConcurrencyï¼Œè®©å¤šä¸ª task çœŸæ­£å¹¶è¡Œæ‰§è¡Œ

#### T1.4 ExecutionContext

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `applications/orchestrator/src/core/ExecutionContext.ts` |
| **å·¥ä½œé‡** | 0.5d |
| **å‰ç½®ä¾èµ–** | T1.1 |
| **æ ¸å¿ƒå†…å®¹** | |

- `Map<nodeId, NodeExecutionResult>` ç»“æ„
- `NodeExecutionResult` = `{ success: boolean; output?: any; error?: string; startedAt: number; completedAt: number }`
- `getUpstreamOutput(nodeId)` ä¾¿æ·æ–¹æ³•
- å…¨å±€å˜é‡åŒº `globalVars: Map<string, any>`ï¼ˆå¦‚ `startTimeStamp`ã€`endTimeStamp`ã€`groupIds`ï¼‰
- é˜²è¯»å–è¿‡æ—¶æ•°æ®ï¼šé€šè¿‡èŠ‚ç‚¹æ‹“æ‰‘é¡ºåºä¿è¯åªè¯»å–å·²å®Œæˆçš„ä¸Šæ¸¸èŠ‚ç‚¹è¾“å‡º

#### T1.5 æ‰§è¡ŒçŠ¶æ€æŒä¹…åŒ–ä¸æ–­ç‚¹ç»­è·‘

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `applications/orchestrator/src/core/ExecutionPersistence.ts` |
| **å·¥ä½œé‡** | 1.5d |
| **å‰ç½®ä¾èµ–** | T1.1, T1.3, T1.4 |
| **æ ¸å¿ƒå†…å®¹** | |

- æŒä¹…åŒ–ç›®æ ‡ï¼š`WorkflowExecution`ï¼ˆå«æµç¨‹å®šä¹‰å¿«ç…§ + å„èŠ‚ç‚¹çŠ¶æ€ + ExecutionContext å¿«ç…§ï¼‰
- å­˜å‚¨æ–¹æ¡ˆï¼šæ–°å»º SQLite æ•°æ®åº“ `synthos_workflow_executions`ï¼Œè·¯å¾„å¯é…ç½®ã€‚SQLiteçš„ä½¿ç”¨è¯·å‚è€ƒç°æœ‰æ–‡ä»¶ã€‚
- æ¯ä¸ªèŠ‚ç‚¹çŠ¶æ€å˜æ›´æ—¶ `upsert` æ›´æ–°å¯¹åº” execution æ–‡æ¡£
- **æ–­ç‚¹ç»­è·‘**ï¼šä» MongoDB æ¢å¤ `WorkflowExecution`ï¼Œè·³è¿‡å·²å®Œæˆçš„èŠ‚ç‚¹ï¼Œä»ç¬¬ä¸€ä¸ª `pending` / `failed` èŠ‚ç‚¹ç»§ç»­
- æä¾›æ¥å£ï¼š
  - `saveExecution(execution: WorkflowExecution): Promise<void>`
  - `loadExecution(executionId: string): Promise<WorkflowExecution | null>`
  - `listExecutions(workflowId: string, limit: number): Promise<WorkflowExecution[]>`

#### T1.6 é‡è¯•/è¶…æ—¶/è·³è¿‡/å¤±è´¥ç­–ç•¥

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | é›†æˆåœ¨ `WorkflowExecutor.ts` å†… |
| **å·¥ä½œé‡** | 1d |
| **å‰ç½®ä¾èµ–** | T1.3 |
| **æ ¸å¿ƒå†…å®¹** | |

- æ¯ä¸ªèŠ‚ç‚¹è¯»å– `retryCount`ï¼ˆé»˜è®¤ 0ï¼‰ã€`timeoutMs`ï¼ˆé»˜è®¤ 0 = æ— è¶…æ—¶ï¼‰ã€`skipOnFailure`ï¼ˆé»˜è®¤ falseï¼‰
- é‡è¯•ï¼šä½¿ç”¨ç°æœ‰ `common/util/retryAsync.ts`
- è¶…æ—¶ï¼š`Promise.race([æ‰§è¡Œ, sleep(timeoutMs)])`
- `skipOnFailure=true`ï¼šèŠ‚ç‚¹å¤±è´¥ä¸ç»ˆæ­¢æµç¨‹ï¼ŒçŠ¶æ€æ ‡è®°ä¸º `skipped`ï¼Œä¸‹æ¸¸èŠ‚ç‚¹ç»§ç»­æ‰§è¡Œ
- `skipOnFailure=false`ï¼ˆé»˜è®¤ï¼‰ï¼šèŠ‚ç‚¹å¤±è´¥åï¼Œæ‰€æœ‰ä¸‹æ¸¸ä¸å¯è¾¾èŠ‚ç‚¹æ ‡è®°ä¸º `cancelled`ï¼Œæµç¨‹å¤±è´¥

#### T1.7 å•å…ƒæµ‹è¯•è¦†ç›–

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `applications/orchestrator/src/test` |
| **å·¥ä½œé‡** | 2d |
| **å‰ç½®ä¾èµ–** | T1.1~T1.6 å…¨éƒ¨å®Œæˆ |
| **æ ¸å¿ƒå†…å®¹** | |

- æ‹“æ‰‘æ’åºæ­£ç¡®æ€§æµ‹è¯•ï¼ˆçº¿æ€§ DAGã€è±å½¢ DAGã€å¤šåˆ†æ”¯ DAGï¼‰
- ç¯æ£€æµ‹æµ‹è¯•
- ä¸²è¡Œæ‰§è¡Œæµ‹è¯•
- å¹¶è¡Œæ‰§è¡Œæµ‹è¯•
- æ¡ä»¶åˆ†æ”¯æµ‹è¯•ï¼ˆtrue/false ä¸¤æ¡è·¯å¾„ï¼‰
- æ±‡èšèŠ‚ç‚¹ç­‰å¾…æµ‹è¯•
- é‡è¯•æµ‹è¯•ï¼ˆæ¨¡æ‹Ÿå¤±è´¥åé‡è¯•æˆåŠŸï¼‰
- è¶…æ—¶æµ‹è¯•
- skipOnFailure æµ‹è¯•
- æ–­ç‚¹ç»­è·‘æµ‹è¯•ï¼ˆæ¨¡æ‹Ÿæ¢å¤åœºæ™¯ï¼‰
- ExecutionContext ä¸Šä¸‹æ¸¸æ•°æ®ä¼ é€’æµ‹è¯•
- äº‹ä»¶å‘å°„æµ‹è¯•

---

### Phase 1ï¼ˆP1ï¼‰ï¼šOrchestrator æ”¹é€  & tRPC é€šä¿¡å±‚

> **ç›®æ ‡**ï¼šè®© Orchestrator ä»"ç¡¬ç¼–ç è„šæœ¬"èœ•å˜ä¸º"å¼•æ“é©±åŠ¨"ï¼Œå¹¶æš´éœ² tRPC æ¥å£ä¾›å‰ç«¯äº¤äº’ã€‚

#### T2.1 Orchestrator tRPC Server æ­å»º

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `applications/orchestrator/src/rpc/` |
| **å·¥ä½œé‡** | 1d |
| **å‰ç½®ä¾èµ–** | P0 å®Œæˆ |
| **æ ¸å¿ƒå†…å®¹** | |

- å‚ç…§ `applications/ai-model/src/rpc/server.ts` çš„æ¨¡å¼
- åˆ›å»º `startOrchestratorRPCServer(impl, port)`
- HTTP + WebSocket åŒåè®®ï¼ˆtRPC subscription éœ€è¦ WSï¼‰
- ç«¯å£é…ç½®æ–°å¢åˆ° `orchestrator` config æ®µï¼š`rpcPort`
- `orchestrator/package.json` å¢åŠ ä¾èµ–ï¼š`ws`ï¼ˆå¦‚æœªåœ¨æ ¹ package.json ä¸­ï¼‰

#### T2.2 RPC æ¥å£å®šä¹‰

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `common/rpc/orchestrator/` |
| **å·¥ä½œé‡** | 1.5d |
| **å‰ç½®ä¾èµ–** | T1.1, T2.1 |
| **æ ¸å¿ƒå†…å®¹** | |

- åˆ›å»º `common/rpc/orchestrator/index.ts`ã€`router.ts`ã€`schemas.ts`
- **æŸ¥è¯¢ç±»æ¥å£**ï¼ˆquery/mutationï¼‰ï¼š
  - `listWorkflows()` â†’ è·å–æ‰€æœ‰æµç¨‹å®šä¹‰åˆ—è¡¨
  - `getWorkflow(id)` â†’ è·å–å•ä¸ªæµç¨‹å®šä¹‰
  - `triggerWorkflow(workflowId, globalVars?)` â†’ æ‰‹åŠ¨è§¦å‘æµç¨‹æ‰§è¡Œ
  - `cancelExecution(executionId)` â†’ å–æ¶ˆæ­£åœ¨è¿è¡Œçš„æ‰§è¡Œ
  - `retryExecution(executionId)` â†’ æ–­ç‚¹ç»­è·‘
  - `listExecutions(workflowId, limit)` â†’ è·å–æ‰§è¡Œå†å²
  - `getExecution(executionId)` â†’ è·å–å•æ¬¡æ‰§è¡Œè¯¦æƒ…ï¼ˆå«å„èŠ‚ç‚¹çŠ¶æ€ï¼‰
- **è®¢é˜…ç±»æ¥å£**ï¼ˆsubscriptionï¼‰ï¼š
  - `onExecutionUpdate(executionId)` â†’ å®æ—¶æ¨é€èŠ‚ç‚¹çŠ¶æ€å˜æ›´äº‹ä»¶
- Zod Schema æ ¡éªŒ

#### T2.3 webui-backend ä½œä¸º tRPC å®¢æˆ·ç«¯è½¬å‘

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `applications/webui-backend/src/rpc/` |
| **å·¥ä½œé‡** | 1d |
| **å‰ç½®ä¾èµ–** | T2.2 |
| **æ ¸å¿ƒå†…å®¹** | |

- åˆ›å»º `orchestratorClient.ts`ï¼ˆå‚ç…§ `aiModelClient.ts`ï¼‰
- åœ¨ DI tokens ä¸­æ–°å¢ `OrchestratorClient`
- åœ¨ `webui-backend/src/rpc/router.ts` çš„ `appRouter` ä¸­æ–°å¢ orchestrator ç›¸å…³è·¯ç”±è½¬å‘
- åœ¨ `webui-backend/src/di/container.ts` ä¸­æ³¨å†Œ client

#### T2.4 ç°æœ‰ç¡¬ç¼–ç  Pipeline åˆ é™¤ & é»˜è®¤æµç¨‹å®šä¹‰è¿ç§»

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `applications/orchestrator/src/index.ts`ï¼ˆé‡å†™ï¼‰ |
| **å·¥ä½œé‡** | 1.5d |
| **å‰ç½®ä¾èµ–** | P0 å®Œæˆ, T2.1, T2.2, T3.2 |
| **æ ¸å¿ƒå†…å®¹** | |

- **åˆ é™¤** `index.ts` ä¸­ `RunPipeline` ä»»åŠ¡çš„ç¡¬ç¼–ç  6 æ­¥ Pipeline é€»è¾‘
- æ–° `index.ts` æµç¨‹ï¼š
  1. åˆå§‹åŒ– DI
  2. ä»é…ç½®ä¸­è¯»å– `WorkflowDefinition[]`
  3. åˆ›å»º `NodeExecutorAdapter` å®ç°ï¼ˆå†…éƒ¨è°ƒç”¨ `agendaInstance.now()` + `waitForJobCompletion`ï¼Œå®Œå…¨å¤ç”¨ç°æœ‰ task handlerï¼‰
  4. å¯¹äºæ¯ä¸ª workflowï¼Œæ ¹æ® `schedule` é…ç½®æ³¨å†Œå®šæ—¶è§¦å‘
  5. å¯åŠ¨ tRPC Server
  6. å¯åŠ¨ Agenda
- ä¿ç•™ `TaskHandlerTypes` æšä¸¾å’Œ `scheduleAndWaitForJob` å‡½æ•°ä¸å˜
- **å¯é€‰ä¿ç•™** `RunPipeline` ç±»å‹ç”¨äºå…¼å®¹è¿‡æ¸¡

#### T2.5 reportScheduler çº³å…¥å®šæ—¶ä»»åŠ¡ä½“ç³»

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | é…ç½® & orchestrator ä»£ç  |
| **å·¥ä½œé‡** | 1d |
| **å‰ç½®ä¾èµ–** | T2.4 |
| **æ ¸å¿ƒå†…å®¹** | |

- å°† `reportScheduler.ts` çš„é€»è¾‘æ”¹é€ ä¸ºç‹¬ç«‹çš„"å®šæ—¶ä»»åŠ¡"é…ç½®é¡¹
- åœ¨ config çš„ `workflows` æˆ–æ–°å¢ `scheduledTasks` å­—æ®µä¸­æ”¯æŒ cron å®šæ—¶è§¦å‘
- åˆ é™¤ `schedulers/reportScheduler.ts`ï¼Œæ”¹ä¸ºå¼•æ“å†…ç½®çš„å®šæ—¶è§¦å‘èƒ½åŠ›æˆ–ç‹¬ç«‹é…ç½®
- ä¿æŒæŠ¥å‘Šç”Ÿæˆçš„åŠŸèƒ½å®Œæ•´æ€§

---

### Phase 2ï¼ˆP2ï¼‰ï¼šæµç¨‹å®šä¹‰å­˜å‚¨ & é…ç½®é›†æˆ

> **ç›®æ ‡**ï¼šæµç¨‹å®šä¹‰æŒä¹…åŒ–åˆ° `synthos_config.json`ï¼Œé€šè¿‡ç°æœ‰é…ç½®é¢æ¿ä½“ç³»ç®¡ç†ã€‚

#### T3.1 GlobalConfig ä¸­æ–°å¢ workflows å­—æ®µ & Schema

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `common/services/config/schemas/GlobalConfig.ts` |
| **å·¥ä½œé‡** | 0.5d |
| **å‰ç½®ä¾èµ–** | T1.1 |
| **æ ¸å¿ƒå†…å®¹** | |

- åœ¨ `GlobalConfigSchema` ä¸­æ–°å¢ï¼š
  ```ts
  workflows: z.array(WorkflowDefinitionSchema).describe("å·¥ä½œæµå®šä¹‰åˆ—è¡¨")
  ```
- `orchestrator` æ®µæ–°å¢ `rpcPort` å­—æ®µ
- æ›´æ–° `synthos_config.json` å’Œ `docker/config/synthos_config.json`

#### T3.2 é»˜è®¤ WorkflowDefinition

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `synthos_config.json` |
| **å·¥ä½œé‡** | 0.5d |
| **å‰ç½®ä¾èµ–** | T3.1 |
| **æ ¸å¿ƒå†…å®¹** | |

- ç¼–å†™ä¸€ä¸ªå¯¹æ ‡ç°æœ‰ 6 æ­¥ Pipeline çš„é»˜è®¤ WorkflowDefinitionï¼š
  ```
  Start â†’ ProvideData â†’ Preprocess â†’ AISummarize â†’ GenerateEmbedding â†’ InterestScore â†’ LLMInterestEvaluationAndNotification â†’ End
  ```
- æ¯ä¸ªèŠ‚ç‚¹çš„ `data.taskType` æ˜ å°„åˆ°ç°æœ‰ `TaskHandlerTypes`
- é…ç½®åˆç†çš„é»˜è®¤ä½ç½®åæ ‡ï¼ˆæ–¹ä¾¿ React Flow å±•ç¤ºï¼‰
- é™„ä¸Šåˆç†çš„ schedule é…ç½®ï¼ˆå¯¹åº”ç°æœ‰ `pipelineIntervalInMinutes`ï¼‰

#### T3.3 é…ç½®ä¿å­˜ Diff ç¡®è®¤æœºåˆ¶

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | å‰ç«¯ config-panel æˆ– workflow é¡µé¢å†… |
| **å·¥ä½œé‡** | 0.5d |
| **å‰ç½®ä¾èµ–** | T4.5 |
| **æ ¸å¿ƒå†…å®¹** | |

- å¤ç”¨ `config-panel/config.tsx` çš„ DiffEditor æ¨¡å¼
- æµç¨‹ç¼–è¾‘åä¿å­˜æ—¶ï¼Œå¼¹å‡º Diff å¯¹æ¯”å¼¹çª—ï¼Œç”¨æˆ·ç¡®è®¤åæ‰å†™å…¥

#### T3.4 è¿è¡Œæ—¶æ·±æ‹·è´å¿«ç…§

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | é›†æˆåœ¨ `WorkflowExecutor.ts` |
| **å·¥ä½œé‡** | å·²åŒ…å«åœ¨ T1.3 ä¸­ |
| **å‰ç½®ä¾èµ–** | T1.3 |
| **æ ¸å¿ƒå†…å®¹** | |

- æ‰§è¡Œå™¨å¯åŠ¨æ—¶ `structuredClone(workflowDefinition)` åˆ›å»ºå¿«ç…§
- å¿«ç…§å­˜å‚¨åœ¨ `WorkflowExecution.snapshot` ä¸­
- è¿è¡ŒæœŸé—´ä¸å—å¤–éƒ¨å¯¹é…ç½®çš„ä¿®æ”¹å½±å“

---

### Phase 3ï¼ˆP3ï¼‰ï¼šå‰ç«¯å¯è§†åŒ–ç¼–æ’é¡µé¢

> **ç›®æ ‡**ï¼šåœ¨ `webui-frontend` ä¸­æ–°å¢ `/workflow` é¡µé¢ï¼ŒåŸºäº React Flow v12 + Zustand æ„å»ºæ‹–æ‹½å¼æµç¨‹ç¼–æ’ UIã€‚

#### T4.1 React Flow + Zustand åŸºç¡€é›†æˆ

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `applications/webui-frontend/src/pages/workflow/` |
| **å·¥ä½œé‡** | 1d |
| **å‰ç½®ä¾èµ–** | æ— ï¼ˆå¯ä¸ P0 å¹¶è¡Œï¼‰ |
| **æ ¸å¿ƒå†…å®¹** | |

- `webui-frontend/package.json` æ–°å¢ä¾èµ–ï¼š`@xyflow/react`ã€`zustand`
- åœ¨æ ¹ monorepo ä¸‹ `pnpm install`
- åˆ›å»ºç›®å½•ç»“æ„ï¼š
  ```
  pages/workflow/
  â”œâ”€â”€ index.tsx              // ä¸»é¡µé¢
  â”œâ”€â”€ components/
  â”‚   â”œâ”€â”€ WorkflowCanvas.tsx // React Flow ç”»å¸ƒ
  â”‚   â”œâ”€â”€ NodePalette.tsx    // èŠ‚ç‚¹é¢æ¿ï¼ˆæ‹–æ‹½æºï¼‰
  â”‚   â”œâ”€â”€ PropertyPanel.tsx  // å±æ€§ç¼–è¾‘é¢æ¿
  â”‚   â””â”€â”€ ExecutionPanel.tsx // æ‰§è¡ŒçŠ¶æ€é¢æ¿
  â”œâ”€â”€ nodes/
  â”‚   â”œâ”€â”€ TaskNode.tsx
  â”‚   â”œâ”€â”€ ConditionNode.tsx
  â”‚   â”œâ”€â”€ StartNode.tsx
  â”‚   â”œâ”€â”€ EndNode.tsx
  â”‚   â”œâ”€â”€ ScriptNode.tsx
  â”‚   â”œâ”€â”€ HttpNode.tsx
  â”‚   â””â”€â”€ ParallelNode.tsx
  â”œâ”€â”€ edges/
  â”‚   â””â”€â”€ ConditionalEdge.tsx
  â”œâ”€â”€ stores/
  â”‚   â””â”€â”€ workflowStore.ts  // Zustand store
  â”œâ”€â”€ hooks/
  â”‚   â”œâ”€â”€ useWorkflowApi.ts
  â”‚   â””â”€â”€ useExecutionStatus.ts
  â””â”€â”€ types/
      â””â”€â”€ index.ts
  ```
- `App.tsx` æ–°å¢è·¯ç”±ï¼š`<Route element={<WorkflowPage />} path="/workflow" />`
- `config/site.ts` æ–°å¢å¯¼èˆªï¼š`{ label: "ğŸ”€æµç¨‹ç¼–æ’", href: "/workflow" }`
- åŸºç¡€ React Flow ç”»å¸ƒï¼ˆç©ºç™½ç”»å¸ƒ + Controls + MiniMap + Backgroundï¼‰

#### T4.2 è‡ªå®šä¹‰èŠ‚ç‚¹ç»„ä»¶

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `pages/workflow/nodes/` |
| **å·¥ä½œé‡** | 2d |
| **å‰ç½®ä¾èµ–** | T4.1 |
| **æ ¸å¿ƒå†…å®¹** | |

- **StartNode**ï¼šåœ†å½¢ç»¿è‰²ï¼Œä»…æœ‰ source handle
- **EndNode**ï¼šåœ†å½¢çº¢è‰²ï¼Œä»…æœ‰ target handle
- **TaskNode**ï¼šå¡ç‰‡å¼ï¼Œæ˜¾ç¤ºä»»åŠ¡ç±»å‹å›¾æ ‡ + label + çŠ¶æ€æŒ‡ç¤ºç¯
  - ä¸‹æ‹‰é€‰æ‹© `TaskHandlerTypes`
  - å³ä¾§ source handle / å·¦ä¾§ target handle
- **ConditionNode**ï¼šè±å½¢ï¼Œå¤šä¸ª source handleï¼ˆtrue/falseï¼‰
  - æ˜¾ç¤ºæ¡ä»¶è¡¨è¾¾å¼é¢„è§ˆ
- **ParallelNode**ï¼šå®½æ¡å½¢ï¼Œç”¨äºæ ‡è®°å¹¶è¡Œåˆ†æ”¯çš„èµ·å§‹/ç»“æŸ
- **ScriptNode**ï¼šä»£ç å›¾æ ‡ï¼Œç‚¹å‡»å¼¹å‡ºä»£ç ç¼–è¾‘å™¨
- **HttpNode**ï¼šç½‘ç»œå›¾æ ‡ï¼Œæ˜¾ç¤º URL å’Œ method
- æ‰€æœ‰èŠ‚ç‚¹æ ¹æ® `NodeExecutionStatus` æ˜¾ç¤ºä¸åŒè¾¹æ¡†é¢œè‰²ï¼š
  - `pending` â†’ ç°è‰²
  - `running` â†’ è“è‰² + è„‰å†²åŠ¨ç”»
  - `success` â†’ ç»¿è‰²
  - `failed` â†’ çº¢è‰²
  - `skipped` â†’ é»„è‰²
  - `cancelled` â†’ æš—ç°è‰²

#### T4.3 èŠ‚ç‚¹å±æ€§é¢æ¿

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `pages/workflow/components/PropertyPanel.tsx` |
| **å·¥ä½œé‡** | 1.5d |
| **å‰ç½®ä¾èµ–** | T4.2 |
| **æ ¸å¿ƒå†…å®¹** | |

- é€‰ä¸­èŠ‚ç‚¹åï¼Œå³ä¾§å±•å¼€å±æ€§é¢æ¿ï¼ˆç±»ä¼¼ VS Code çš„ Propertiesï¼‰
- æ ¹æ®èŠ‚ç‚¹ç±»å‹åŠ¨æ€æ¸²æŸ“ä¸åŒè¡¨å•ï¼š
  - **task**ï¼šä»»åŠ¡ç±»å‹ä¸‹æ‹‰ã€å‚æ•° JSON ç¼–è¾‘ã€é‡è¯•æ¬¡æ•°ã€è¶…æ—¶æ—¶é—´ã€å¤±è´¥è·³è¿‡å¼€å…³
  - **condition**ï¼šæ¡ä»¶ç±»å‹ä¸‹æ‹‰ï¼ˆé¢„å®šä¹‰æ¡ä»¶åˆ—è¡¨ï¼‰+ è‡ªå®šä¹‰ key-value åŒ¹é…è¡¨å•
  - **script**ï¼šMonaco Editorï¼ˆå¤ç”¨é¡¹ç›®å·²æœ‰çš„ `@monaco-editor/react`ï¼‰
  - **http**ï¼šURLã€Methodã€Headers KV ç¼–è¾‘å™¨ã€Body
- ä½¿ç”¨ HeroUI çš„ Input/Select/Switch ç­‰ç»„ä»¶ï¼Œç¡®ä¿ `size="sm"` ç´§å‡‘

#### T4.4 æ‹–æ‹½æ·»åŠ èŠ‚ç‚¹ & è¿çº¿äº¤äº’

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `pages/workflow/components/NodePalette.tsx` + canvas äº¤äº’ |
| **å·¥ä½œé‡** | 1d |
| **å‰ç½®ä¾èµ–** | T4.1, T4.2 |
| **æ ¸å¿ƒå†…å®¹** | |

- å·¦ä¾§å›ºå®šé¢æ¿å±•ç¤ºæ‰€æœ‰å¯ç”¨èŠ‚ç‚¹ç±»å‹ï¼ˆæ‹–æ‹½æºï¼‰
- æ‹–æ‹½åˆ°ç”»å¸ƒä¸Šè‡ªåŠ¨åˆ›å»ºå¯¹åº”ç±»å‹çš„èŠ‚ç‚¹
- è¿çº¿è§„åˆ™æ ¡éªŒï¼š
  - start èŠ‚ç‚¹ä¸å¯æœ‰å…¥è¾¹
  - end èŠ‚ç‚¹ä¸å¯æœ‰å‡ºè¾¹
  - ä¸å…è®¸è‡ªç¯
  - æ¡ä»¶èŠ‚ç‚¹çš„å‡ºè¾¹å¿…é¡»æŒ‡å®š handleï¼ˆtrue/falseï¼‰
- å³é”®ä¸Šä¸‹æ–‡èœå•ï¼šåˆ é™¤èŠ‚ç‚¹/è¾¹ã€å¤åˆ¶èŠ‚ç‚¹
- é”®ç›˜å¿«æ·é”®ï¼šDelete åˆ é™¤é€‰ä¸­é¡¹

#### T4.5 æµç¨‹ä¿å­˜/åŠ è½½/Diff é¢„è§ˆ

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | workflow é¡µé¢ + æ–°å¢ API |
| **å·¥ä½œé‡** | 1.5d |
| **å‰ç½®ä¾èµ–** | T4.1, T2.3, T3.1 |
| **æ ¸å¿ƒå†…å®¹** | |

- å‰ç«¯æ–°å¢ `api/workflowApi.ts`ï¼š
  - `fetchWorkflows()` â†’ GET è·å–æ‰€æœ‰æµç¨‹å®šä¹‰
  - `saveWorkflow(workflow)` â†’ POST ä¿å­˜æµç¨‹å®šä¹‰
- "ä¿å­˜"æŒ‰é’® â†’ å¼¹å‡º Diff å¯¹æ¯”å¼¹çª—ï¼ˆå¯¹æ¯”æ–°æ—§ JSONï¼‰â†’ ç¡®è®¤åè°ƒç”¨ save API
- "åŠ è½½"ï¼šè¿›å…¥é¡µé¢æ—¶è‡ªåŠ¨ä» API åŠ è½½æµç¨‹å®šä¹‰åˆ—è¡¨
- Workflow åˆ—è¡¨é€‰æ‹©å™¨ï¼ˆé¡¶éƒ¨ Tabs æˆ–ä¸‹æ‹‰ï¼‰ï¼Œæ”¯æŒåˆ‡æ¢ä¸åŒæµç¨‹
- URL å‚æ•°åæ˜ å½“å‰é€‰ä¸­çš„ `workflowId`

#### T4.6 æ‰§è¡ŒçŠ¶æ€å®æ—¶å¯è§†åŒ–

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | workflow é¡µé¢ + tRPC subscription |
| **å·¥ä½œé‡** | 2d |
| **å‰ç½®ä¾èµ–** | T4.2, T2.3 |
| **æ ¸å¿ƒå†…å®¹** | |

- é€šè¿‡ tRPC subscriptionï¼ˆ`onExecutionUpdate`ï¼‰æ¥æ”¶å®æ—¶èŠ‚ç‚¹çŠ¶æ€å˜æ›´
- æ›´æ–° Zustand store ä¸­çš„èŠ‚ç‚¹çŠ¶æ€ â†’ è§¦å‘ React Flow é‡æ–°æ¸²æŸ“èŠ‚ç‚¹é¢œè‰²/åŠ¨ç”»
- é¡¶éƒ¨å·¥å…·æ æ˜¾ç¤ºå½“å‰æ‰§è¡ŒçŠ¶æ€ï¼š`æœªè¿è¡Œ` / `è¿è¡Œä¸­(3/8)` / `å·²å®Œæˆ` / `å·²å¤±è´¥`
- "æ‰‹åŠ¨è§¦å‘"æŒ‰é’® â†’ è°ƒç”¨ `triggerWorkflow` RPC
- "å–æ¶ˆæ‰§è¡Œ"æŒ‰é’®
- "æ–­ç‚¹ç»­è·‘"æŒ‰é’®ï¼ˆä»…åœ¨å¤±è´¥çŠ¶æ€ä¸‹å¯ç”¨ï¼‰

#### T4.7 æµç¨‹æ‰§è¡Œå†å²åˆ—è¡¨

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `pages/workflow/components/ExecutionPanel.tsx` |
| **å·¥ä½œé‡** | 1d |
| **å‰ç½®ä¾èµ–** | T4.6, T2.3 |
| **æ ¸å¿ƒå†…å®¹** | |

- åº•éƒ¨æˆ–å³ä¾§é¢æ¿å±•ç¤ºæ‰§è¡Œå†å²åˆ—è¡¨
- æ¯æ¡è®°å½•æ˜¾ç¤ºï¼šæ‰§è¡Œ IDã€çŠ¶æ€ã€å¼€å§‹æ—¶é—´ã€è€—æ—¶ã€èŠ‚ç‚¹è¿›åº¦
- ç‚¹å‡»æŸæ¡è®°å½• â†’ åœ¨ç”»å¸ƒä¸ŠåŠ è½½è¯¥æ¬¡æ‰§è¡Œçš„å¿«ç…§ + èŠ‚ç‚¹çŠ¶æ€é«˜äº®
- åˆ†é¡µåŠ è½½

---

### Phase 4ï¼ˆP4ï¼‰ï¼šæ—¥å¿—ç³»ç»Ÿæ”¹é€ 

> **ç›®æ ‡**ï¼šè®©æ¯æ¬¡æµç¨‹æ‰§è¡Œçš„æ—¥å¿—å¯æŒ‰ executionId è¿‡æ»¤ï¼Œå¹¶åœ¨å·¥ä½œæµé¡µé¢å†…ç›´æ¥æŸ¥çœ‹ã€‚

#### T5.1 Logger å¢åŠ æ‰§è¡Œ ID æ ‡ç­¾

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `common/util/Logger.ts`ï¼ˆå¢å¼ºï¼‰ |
| **å·¥ä½œé‡** | 0.5d |
| **å‰ç½®ä¾èµ–** | T1.3 |
| **æ ¸å¿ƒå†…å®¹** | |

- Logger å¢åŠ  `withExecutionId(executionId: string)` å·¥å‚æ–¹æ³•
- æ—¥å¿—è¡Œæ ¼å¼å¢åŠ å¯é€‰çš„ `[execId:xxx]` å‰ç¼€
- å¼•æ“åœ¨æ‰§è¡Œæ¯ä¸ªèŠ‚ç‚¹æ—¶ï¼Œé€šè¿‡ `NodeExecutorAdapter` ä¼ å…¥å¸¦ executionId çš„ Logger

#### T5.2 åç«¯ Logs API æ”¯æŒæŒ‰ executionId/taskName è¿‡æ»¤

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `webui-backend` LogsController/Service |
| **å·¥ä½œé‡** | 0.5d |
| **å‰ç½®ä¾èµ–** | T5.1 |
| **æ ¸å¿ƒå†…å®¹** | |

- `QueryLogsSchema` æ–°å¢å¯é€‰å­—æ®µ `executionId?: string`ã€`taskName?: string`
- LogsService çš„æ—¥å¿—æ–‡ä»¶æŸ¥è¯¢å¢åŠ å¯¹åº”è¿‡æ»¤é€»è¾‘
- åç«¯å¯¹åº” schemas æ›´æ–°

#### T5.3 logs.tsx æå‡ä¸ºå…¬å…±ç»„ä»¶

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | `src/components/LogViewer.tsx`ï¼ˆä» pages/system-monitor/logs.tsx æå–ï¼‰ |
| **å·¥ä½œé‡** | 1d |
| **å‰ç½®ä¾èµ–** | T5.2 |
| **æ ¸å¿ƒå†…å®¹** | |

- å°† `pages/system-monitor/logs.tsx` çš„æ ¸å¿ƒæ—¥å¿—å±•ç¤ºé€»è¾‘æå–ä¸º `components/LogViewer.tsx`
- å…¬å…±ç»„ä»¶ Propsï¼š`executionId?`ã€`taskName?`ã€`autoRefresh?`ã€`height?` ç­‰
- `pages/system-monitor/logs.tsx` æ”¹ä¸ºå¼•ç”¨å…¬å…±ç»„ä»¶
- ç¡®ä¿ç»„ä»¶ < 400 è¡Œï¼Œå¿…è¦æ—¶æ‹†åˆ†å­ç»„ä»¶

#### T5.4 å·¥ä½œæµé¡µé¢å†…åµŒæ—¥å¿—é¢æ¿

| å±æ€§ | è¯´æ˜ |
|------|------|
| **äº§å‡ºä½ç½®** | workflow é¡µé¢ |
| **å·¥ä½œé‡** | 0.5d |
| **å‰ç½®ä¾èµ–** | T5.3, T4.6 |
| **æ ¸å¿ƒå†…å®¹** | |

- åœ¨æ‰§è¡ŒçŠ¶æ€é¢æ¿ä¸‹æ–¹åµŒå…¥ `<LogViewer executionId={currentExecutionId} />`
- è‡ªåŠ¨åˆ·æ–° + è·Ÿéšæ»šåŠ¨

---

### Phase 5ï¼ˆP5ï¼‰ï¼šæ–‡æ¡£ & å–„å

> **ç›®æ ‡**ï¼šæ›´æ–°æ‰€æœ‰ç›¸å…³æ–‡æ¡£ï¼Œç¡®ä¿æ–‡æ¡£ä¸ä»£ç åŒæ­¥ã€‚

#### T6.1 ~ T6.5 æ–‡æ¡£æ›´æ–°

| å±æ€§ | è¯´æ˜ |
|------|------|
| **å·¥ä½œé‡** | 2dï¼ˆå…¨éƒ¨æ–‡æ¡£ï¼‰ |
| **å‰ç½®ä¾èµ–** | P0~P4 å…¨éƒ¨å®Œæˆ |
| **æ ¸å¿ƒå†…å®¹** | |

- **æ ¹ç›®å½• README.md**ï¼š
  - åŠŸèƒ½ç‰¹æ€§æ–°å¢"å¯è§†åŒ–å·¥ä½œæµç¼–æ’"
  - TODO æ„¿æœ›å•ä¸­ `[TODO] æ”¯æŒå¯è§†åŒ–ä»»åŠ¡ç¼–æ’` æ ‡è®°ä¸º âœ…
  - æŠ€æœ¯æ¶æ„ â†’ æ ¸å¿ƒæŠ€æœ¯æ ˆæ–°å¢ `React Flow`ã€`Zustand`
  - æ¨¡å—åˆ’åˆ†è¡¨æ›´æ–° `orchestrator` æè¿°
- **orchestrator/README.md**ï¼š
  - å®Œå…¨é‡å†™ï¼Œæè¿°æ–°çš„æµç¨‹å¼•æ“æ¶æ„
- **docs/æ¥å£æ–‡æ¡£/APIæ–‡æ¡£.md**ï¼š
  - æ–°å¢ Orchestrator RPC æ¥å£ç« èŠ‚
- **docs/å·¥ä½œæµç¼–æ’ä½¿ç”¨æŒ‡å—.md**ï¼ˆæ–°å»ºï¼‰ï¼š
  - é¢å‘ç”¨æˆ·çš„æ“ä½œæ‰‹å†Œï¼ˆå«æˆªå›¾å ä½ç¬¦ï¼‰
  - åŒ…æ‹¬ï¼šåˆ›å»ºæµç¨‹ã€ç¼–è¾‘èŠ‚ç‚¹ã€æ‰§è¡Œæµç¨‹ã€æŸ¥çœ‹æ—¥å¿—ã€æ–­ç‚¹ç»­è·‘ç­‰
- **docs/å·¥ä½œæµç¼–æ’æŠ€æœ¯æŠ¥å‘Š.md**ï¼ˆæ–°å»ºï¼‰ï¼š
  - é¢å‘å¼€å‘è€…çš„æŠ€æœ¯æ–‡æ¡£
  - åŒ…æ‹¬ï¼šå¼•æ“æ¶æ„è®¾è®¡ã€DAG è§£æç®—æ³•ã€æ‰§è¡Œæ¨¡å‹ã€æŒä¹…åŒ–æ–¹æ¡ˆã€tRPC é€šä¿¡é“¾è·¯ç­‰

---

## ä¸‰ã€ä¾èµ–å…³ç³»å›¾

```
T1.1 â”€â”€â†’ T1.2 â”€â”€â†’ T1.3 â”€â”€â†’ T1.5
  â”‚                  â”‚        â†‘
  â”‚                  â†“        â”‚
  â”‚               T1.6       T1.4
  â”‚                  â”‚
  â†“                  â†“
T3.1              T1.7ï¼ˆç­‰å…¨éƒ¨å®Œæˆï¼‰
  â”‚
  â†“
T3.2 â”€â”€â†’ T2.4
  
T2.1 â”€â”€â†’ T2.2 â”€â”€â†’ T2.3
                     â”‚
                     â†“
                   T4.5, T4.6, T4.7

T4.1 â”€â”€â†’ T4.2 â”€â”€â†’ T4.3
  â”‚        â”‚
  â”‚        â†“
  â”‚      T4.4
  â†“
T4.5 â”€â”€â†’ T3.3

T5.1 â”€â”€â†’ T5.2 â”€â”€â†’ T5.3 â”€â”€â†’ T5.4

P0~P4 å…¨éƒ¨å®Œæˆ â”€â”€â†’ P5ï¼ˆæ–‡æ¡£ï¼‰
```

---

## å››ã€æ’æœŸå»ºè®®ï¼ˆæŒ‰è¿­ä»£ï¼‰

### è¿­ä»£ 1ï¼šå¼•æ“å†…æ ¸ï¼ˆçº¦ 9.5dï¼‰

| ä»»åŠ¡ | å·¥ä½œé‡ | å¯å¹¶è¡Œ | è´Ÿè´£äºº(Agent) |
|------|--------|--------|--------------|
| T1.1 æµç¨‹å®šä¹‰å¥‘çº¦ | 0.5d | - | Agent A |
| T1.2 DAG æ‹“æ‰‘è§£æ | 1d | - | Agent A |
| T1.4 ExecutionContext | 0.5d | âœ… ä¸ T1.2 å¹¶è¡Œ | Agent B |
| T1.3 æ‰§è¡Œå¼•æ“æ ¸å¿ƒ | 3d | éœ€ T1.1+T1.2+T1.4 | Agent A |
| T1.5 çŠ¶æ€æŒä¹…åŒ– | 1.5d | éœ€ T1.3 | Agent A |
| T1.6 ç­–ç•¥é›†æˆ | 1d | âœ… ä¸ T1.5 å¹¶è¡Œ | Agent B |
| T1.7 å•å…ƒæµ‹è¯• | 2d | éœ€å…¨éƒ¨å®Œæˆ | Agent A + B |

**å…³é”®è·¯å¾„**ï¼šT1.1 â†’ T1.2 â†’ T1.3 â†’ T1.5 â†’ T1.7ï¼ˆçº¦ 8dï¼‰

### è¿­ä»£ 2ï¼šOrchestrator æ”¹é€  + é…ç½®é›†æˆï¼ˆçº¦ 6dï¼‰

| ä»»åŠ¡ | å·¥ä½œé‡ | å¯å¹¶è¡Œ | è´Ÿè´£äºº(Agent) |
|------|--------|--------|--------------|
| T2.1 tRPC Server æ­å»º | 1d | âœ… | Agent C |
| T2.2 RPC æ¥å£å®šä¹‰ | 1.5d | éœ€ T2.1 | Agent C |
| T3.1 Config Schema æ‰©å±• | 0.5d | âœ… ä¸ T2.1 å¹¶è¡Œ | Agent D |
| T3.2 é»˜è®¤æµç¨‹å®šä¹‰ | 0.5d | éœ€ T3.1 | Agent D |
| T2.4 Pipeline è¿ç§» | 1.5d | éœ€ T2.2+T3.2 | Agent C |
| T2.5 reportScheduler æ”¹é€  | 1d | éœ€ T2.4 | Agent C |
| T2.3 Backend è½¬å‘ | 1d | âœ… ä¸ T2.4 å¹¶è¡Œ | Agent D |

**å…³é”®è·¯å¾„**ï¼šT2.1 â†’ T2.2 â†’ T2.4 â†’ T2.5ï¼ˆçº¦ 5dï¼‰

### è¿­ä»£ 3ï¼šå‰ç«¯å¯è§†åŒ–é¡µé¢ï¼ˆçº¦ 10dï¼‰

| ä»»åŠ¡ | å·¥ä½œé‡ | å¯å¹¶è¡Œ | è´Ÿè´£äºº(Agent) |
|------|--------|--------|--------------|
| T4.1 åŸºç¡€é›†æˆ | 1d | âœ… å¯ä¸è¿­ä»£ 2 å¹¶è¡Œ | Agent E |
| T4.2 è‡ªå®šä¹‰èŠ‚ç‚¹ | 2d | éœ€ T4.1 | Agent E |
| T4.3 å±æ€§é¢æ¿ | 1.5d | éœ€ T4.2 | Agent E |
| T4.4 æ‹–æ‹½äº¤äº’ | 1d | âœ… ä¸ T4.3 å¹¶è¡Œ | Agent F |
| T4.5 ä¿å­˜/åŠ è½½/Diff | 1.5d | éœ€ T4.1+T2.3 | Agent F |
| T4.6 æ‰§è¡ŒçŠ¶æ€å¯è§†åŒ– | 2d | éœ€ T4.2+T2.3 | Agent E |
| T4.7 æ‰§è¡Œå†å² | 1d | éœ€ T4.6 | Agent F |

**å…³é”®è·¯å¾„**ï¼šT4.1 â†’ T4.2 â†’ T4.6 â†’ T4.7ï¼ˆçº¦ 6dï¼‰

### è¿­ä»£ 4ï¼šæ—¥å¿—æ”¹é€ ï¼ˆçº¦ 2.5dï¼‰

| ä»»åŠ¡ | å·¥ä½œé‡ | å¯å¹¶è¡Œ | è´Ÿè´£äºº(Agent) |
|------|--------|--------|--------------|
| T5.1 Logger å¢å¼º | 0.5d | âœ… å¯ä¸è¿­ä»£ 3 å¹¶è¡Œ | Agent G |
| T5.2 Logs API æ‰©å±• | 0.5d | éœ€ T5.1 | Agent G |
| T5.3 LogViewer å…¬å…±ç»„ä»¶ | 1d | éœ€ T5.2 | Agent G |
| T5.4 å†…åµŒæ—¥å¿—é¢æ¿ | 0.5d | éœ€ T5.3+T4.6 | Agent G |

### è¿­ä»£ 5ï¼šæ–‡æ¡£ï¼ˆçº¦ 2dï¼‰

| ä»»åŠ¡ | å·¥ä½œé‡ | å¯å¹¶è¡Œ | è´Ÿè´£äºº(Agent) |
|------|--------|--------|--------------|
| T6.1~T6.5 å…¨éƒ¨æ–‡æ¡£ | 2d | å…¨éƒ¨å¹¶è¡Œ | Agent H |

---

## äº”ã€æ€»å·¥ä½œé‡ä¼°ç®—

| é˜¶æ®µ | ä¸²è¡Œå·¥ä½œé‡ | è€ƒè™‘å¹¶è¡Œåæœ€çŸ­è·¯å¾„ |
|------|-----------|-------------------|
| P0 å¼•æ“å†…æ ¸ | 9.5d | ~8d |
| P1 Orchestrator æ”¹é€  | 6d | ~5d |
| P2 é…ç½®é›†æˆ | 1.5d | å«åœ¨ P1 ä¸­ |
| P3 å‰ç«¯ç¼–æ’ | 10d | ~6dï¼ˆè€ƒè™‘ä¸ P1 å¹¶è¡Œï¼‰ |
| P4 æ—¥å¿—æ”¹é€  | 2.5d | ~2dï¼ˆä¸ P3 å¹¶è¡Œï¼‰ |
| P5 æ–‡æ¡£ | 2d | ~2d |
| **åˆè®¡** | **~31.5d** | **~18dï¼ˆå……åˆ†å¹¶è¡Œï¼‰** |

---

## å…­ã€æ¶‰åŠæ”¹åŠ¨çš„æ–‡ä»¶æ¸…å•ï¼ˆé¢„è§ˆï¼‰

### æ–°å¢æ–‡ä»¶
- `common/contracts/workflow/index.ts`
- `applications/orchestrator/src/core/DagParser.ts`
- `applications/orchestrator/src/core/WorkflowExecutor.ts`
- `applications/orchestrator/src/core/ExecutionContext.ts`
- `applications/orchestrator/src/core/ExecutionPersistence.ts`
- `applications/orchestrator/src/core/types.ts`ï¼ˆè‹¥éœ€è¦é¢å¤–ç±»å‹ï¼‰
- `common/rpc/orchestrator/index.ts`
- `common/rpc/orchestrator/router.ts`
- `common/rpc/orchestrator/schemas.ts`
- `applications/orchestrator/src/test/*.test.ts`
- `applications/orchestrator/src/rpc/server.ts`
- `applications/orchestrator/src/rpc/setupRPC.ts`
- `applications/orchestrator/src/adapters/AgendaNodeExecutorAdapter.ts`
- `applications/webui-backend/src/rpc/orchestratorClient.ts`
- `applications/webui-frontend/src/pages/workflow/**`
- `applications/webui-frontend/src/api/workflowApi.ts`
- `applications/webui-frontend/src/components/LogViewer.tsx`
- `docs/å·¥ä½œæµç¼–æ’ä½¿ç”¨æŒ‡å—.md`
- `docs/å·¥ä½œæµç¼–æ’æŠ€æœ¯æŠ¥å‘Š.md`

### ä¿®æ”¹æ–‡ä»¶
- `common/services/config/schemas/GlobalConfig.ts`
- `common/di/tokens.ts`
- `common/di/container.ts`
- `common/util/Logger.ts`
- `common/scheduler/@types/Tasks.ts`ï¼ˆå¯èƒ½å¾®è°ƒï¼‰
- `applications/orchestrator/src/index.ts`ï¼ˆé‡å†™ï¼‰
- `applications/orchestrator/package.json`
- `applications/orchestrator/README.md`
- `applications/webui-backend/src/rpc/router.ts`
- `applications/webui-backend/src/di/tokens.ts`
- `applications/webui-backend/src/di/container.ts`
- `applications/webui-backend/src/schemas/index.ts`
- `applications/webui-backend/src/controllers/LogsController.ts`
- `applications/webui-backend/src/services/LogsService.ts`
- `applications/webui-frontend/src/App.tsx`
- `applications/webui-frontend/src/config/site.ts`
- `applications/webui-frontend/src/pages/system-monitor/logs.tsx`
- `applications/webui-frontend/package.json`
- `synthos_config.json`
- `docker/config/synthos_config.json`
- `README.md`
- `docs/æ¥å£æ–‡æ¡£/APIæ–‡æ¡£.md`

### åˆ é™¤æ–‡ä»¶
- `applications/orchestrator/src/schedulers/reportScheduler.ts`ï¼ˆæ”¹é€ ååˆ é™¤ï¼‰

---

## ä¸ƒã€é£é™©ä¸æ³¨æ„äº‹é¡¹

| é£é™©é¡¹ | å½±å“ | åº”å¯¹ç­–ç•¥ |
|--------|------|---------|
| DAG å¼•æ“ä¸ Agenda çš„é›†æˆè¾¹ç•Œæ¨¡ç³Š | å¼•æ“å¯èƒ½å¯¹ Agenda äº§ç”Ÿéšå¼ä¾èµ– | `NodeExecutorAdapter` ä½œä¸ºå”¯ä¸€æ¡¥æ¢ï¼Œå¼•æ“ä¸ç›´æ¥å¼•ç”¨ Agenda |
| å¹¶è¡ŒèŠ‚ç‚¹æ‰§è¡Œæ—¶ Agenda å¹¶å‘é™åˆ¶ | Agenda `maxConcurrency=1` å¯èƒ½é˜»å¡å¹¶è¡ŒèŠ‚ç‚¹ | å¹¶è¡ŒèŠ‚ç‚¹åº”åˆ†åˆ«åˆ›å»ºç‹¬ç«‹ jobï¼Œç¡®è®¤ Agenda å¹¶å‘é…ç½®æˆ–åœ¨ adapter å±‚åšå¹¶å‘æ§åˆ¶ |
| tRPC subscription åœ¨ WebSocket æ–­è¿æ—¶ä¸¢å¤±äº‹ä»¶ | å‰ç«¯å¯èƒ½çœ‹ä¸åˆ°éƒ¨åˆ†çŠ¶æ€æ›´æ–° | å‰ç«¯ subscription æ–­å¼€åè‡ªåŠ¨é‡è¿ + é‡è¿æ—¶å…¨é‡æ‹‰å–æœ€æ–°çŠ¶æ€ |
| æµç¨‹å®šä¹‰å­˜å‚¨åœ¨ JSON é…ç½®æ–‡ä»¶ä¸­ï¼Œå¤§é‡æµç¨‹æ—¶æ€§èƒ½é—®é¢˜ | æ–‡ä»¶è¯»å†™å˜æ…¢ | å½“å‰é˜¶æ®µå¯æ¥å—ï¼›æœªæ¥å¯è¿ç§»åˆ° MongoDBï¼Œä½†éœ€è¦è¾ƒå¤§æ”¹åŠ¨ |
| React Flow å¤§é‡èŠ‚ç‚¹æ—¶çš„æ¸²æŸ“æ€§èƒ½ | èŠ‚ç‚¹ > 100 æ—¶å¯èƒ½å¡é¡¿ | å®é™…å·¥ä½œæµèŠ‚ç‚¹æ•°é€šå¸¸ < 20ï¼Œæš‚ä¸è€ƒè™‘ï¼›å¦‚æœ‰éœ€è¦å¯å¯ç”¨è™šæ‹ŸåŒ– |
| æ–­ç‚¹ç»­è·‘æ—¶èŠ‚ç‚¹å¹‚ç­‰æ€§ | é‡å¤æ‰§è¡Œå¯èƒ½äº§ç”Ÿé‡å¤æ•°æ® | éœ€åœ¨å„ task handler ä¸­ä¿è¯å¹‚ç­‰ï¼ˆè¿™æ˜¯æ—¢æœ‰é—®é¢˜ï¼Œéæœ¬æ¬¡æ–°å¢ï¼‰ |
| `[MUST]` import index.ts ä¸èƒ½çœç•¥ `index` | ç¼–è¯‘å·¥å…·é“¾é™åˆ¶ | æ‰€æœ‰æ–°å¢æ–‡ä»¶çš„ import è·¯å¾„ä¸¥æ ¼éµå¾ª `from "../xxx/index"` |

---

## å…«ã€ç»™ Agent çš„ä»»åŠ¡åˆ†æ´¾å»ºè®®

ä¸ºäº†å……åˆ†åˆ©ç”¨å¹¶è¡Œèƒ½åŠ›ï¼Œå»ºè®®å¦‚ä¸‹åˆ†æ´¾ï¼š

| Agent | è´Ÿè´£é˜¶æ®µ | è¯´æ˜ |
|-------|---------|------|
| **Agent A** | P0ï¼ˆå¼•æ“å†…æ ¸ï¼‰ | æœ€æ ¸å¿ƒã€æœ€ç‹¬ç«‹çš„éƒ¨åˆ†ï¼Œä¸æ¶‰åŠä»»ä½•å­é¡¹ç›®çš„ä¸šåŠ¡ä»£ç  |
| **Agent B** | P0 è¾…åŠ© + T1.7 æµ‹è¯• | è´Ÿè´£ ExecutionContextã€ç­–ç•¥æ¨¡å—å’Œå…¨éƒ¨å•å…ƒæµ‹è¯• |
| **Agent C** | P1ï¼ˆOrchestrator æ”¹é€ ï¼‰ | éœ€è¦å¯¹ç°æœ‰ orchestrator ä»£ç éå¸¸ç†Ÿæ‚‰ |
| **Agent D** | P2 + T2.3ï¼ˆé…ç½® + Backend è½¬å‘ï¼‰ | æ¶‰åŠ config schema å’Œ webui-backend |
| **Agent E** | P3 å‰ç«¯ï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰ | React Flow è‡ªå®šä¹‰èŠ‚ç‚¹ã€æ‰§è¡ŒçŠ¶æ€å¯è§†åŒ– |
| **Agent F** | P3 å‰ç«¯ï¼ˆè¾…åŠ©éƒ¨åˆ†ï¼‰ | æ‹–æ‹½äº¤äº’ã€ä¿å­˜åŠ è½½ã€æ‰§è¡Œå†å² |
| **Agent G** | P4ï¼ˆæ—¥å¿—æ”¹é€ ï¼‰ | ç‹¬ç«‹æ¨¡å—ï¼Œå¯ä¸å‰ç«¯å¹¶è¡Œ |
| **Agent H** | P5ï¼ˆæ–‡æ¡£ï¼‰ | å…¨éƒ¨å®Œæˆåç»Ÿä¸€ç¼–å†™ |

**å»ºè®®çš„å¹¶è¡Œæ—¶é—´çº¿ï¼š**

```
Week 1:  [Agent A: T1.1â†’T1.2â†’T1.3]  [Agent B: T1.4]  [Agent E: T4.1â†’T4.2]
Week 2:  [Agent A: T1.3â†’T1.5]       [Agent B: T1.6]   [Agent E: T4.3]  [Agent C: T2.1â†’T2.2]  [Agent D: T3.1â†’T3.2]
Week 3:  [Agent A+B: T1.7]          [Agent C: T2.4â†’T2.5]  [Agent D: T2.3]  [Agent E: T4.6]  [Agent F: T4.4â†’T4.5]
Week 4:  [Agent E: T4.6]  [Agent F: T4.7]  [Agent G: T5.1â†’T5.4]  [Agent C: T3.3]
Week 5:  [Agent H: T6.1â†’T6.5]  æœ€ç»ˆé›†æˆæµ‹è¯•
```

---

## ä¹ã€éªŒæ”¶æ ‡å‡†

1. **å¼•æ“å†…æ ¸**ï¼šæ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ï¼Œè¦†ç›–ç‡ > 80%
2. **Pipeline å…¼å®¹**ï¼šé»˜è®¤æµç¨‹å®šä¹‰æ‰§è¡Œç»“æœä¸æ—§ç¡¬ç¼–ç  Pipeline å®Œå…¨ä¸€è‡´
3. **å‰ç«¯**ï¼šå¯æ‹–æ‹½åˆ›å»ºæµç¨‹ã€ä¿å­˜/åŠ è½½ã€å®æ—¶æŸ¥çœ‹æ‰§è¡ŒçŠ¶æ€
4. **æ—¥å¿—**ï¼šåœ¨å·¥ä½œæµé¡µé¢å¯æŒ‰ executionId æŸ¥çœ‹å¯¹åº”æ—¥å¿—
5. **æ–‡æ¡£**ï¼šæ‰€æœ‰æ–‡æ¡£æ›´æ–°å®Œæ¯•ä¸”ä¸ä»£ç åŒæ­¥
6. **ç±»å‹æ£€æŸ¥**ï¼šæ‰€æœ‰æ¶‰åŠçš„å­é¡¹ç›® `npx tsc --noEmit` é€šè¿‡
7. **æ—§ä»£ç æ¸…ç†**ï¼šorchestrator ä¸­æ— æ®‹ç•™ç¡¬ç¼–ç  Pipeline ä»£ç 
